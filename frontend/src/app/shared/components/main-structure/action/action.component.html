<mat-toolbar class="second-toolbar" *ngIf="sharedProp.action.content_title">
  <mat-icon>{{ sharedProp.action.content_icon }}</mat-icon>&nbsp;&nbsp;<span>{{ sharedProp.action.content_title }}</span>

  <span class="mat-spacer"></span>

  <button mat-flat-button color="primary" routerLink="{{ sharedProp.action.add_button }}" *ngIf="sharedProp.action.add_button">
    <mat-icon>add</mat-icon> AÑADIR
  </button>

  <!-- ------------------------------------------------------------------------------------------------------------------------ -->
  <!-- SPECIFIC CASES: -->
  <!-- ------------------------------------------------------------------------------------------------------------------------ -->
  <span *ngIf="sharedProp.action.add_slots_batch">
    &nbsp;
    <button mat-flat-button color="accent" routerLink="{{ sharedProp.action.add_slots_batch }}">
      <mat-icon>content_copy</mat-icon> GENERAR LOTE
    </button>
  </span>

  <!-- Only super user can add machine users -->
  <span *ngIf="sharedProp.action.add_machine && sharedProp.userLogged.permissions[0].role == 1">
    &nbsp;
    <button mat-flat-button color="accent" routerLink="{{ sharedProp.action.add_machine }}">
      <mat-icon>add_box</mat-icon> AÑADIR USUARIO MAQUINA
    </button>
  </span>

  <span *ngIf="sharedProp.action.appointments_drafts">
    &nbsp;
    <button mat-flat-button color="accent" (click)="resumeAppointmentDraft(sharedProp.action.appointments_drafts._id)">
      <mat-icon>published_with_changes</mat-icon> CONTINUAR CITA EN CURSO
    </button>
    &nbsp;
    <button mat-flat-button (click)="deleteAppointmentsDrafts(sharedProp.action.appointments_drafts)">
      <mat-icon>delete_forever</mat-icon> DESCARTAR CITA EN CURSO
    </button>
  </span>
  <!-- ------------------------------------------------------------------------------------------------------------------------ -->
</mat-toolbar>

<div *ngIf="sharedProp.action.filters_form">
  <div class="main-action" fxLayout="row" fxLayoutAlign="start center">
    <div> <!-- start fxLayout wrapper -->
      <mat-form-field appearance="outline" *ngIf="sharedProp.action.filters.search">
        <mat-label>Buscar</mat-label>
        <input matInput type="search" placeholder="Criterio de busqueda" [(ngModel)]="sharedProp.filter" (keyup.enter)="onSearch();">
        <mat-icon matSuffix>search</mat-icon>
      </mat-form-field>

      <mat-form-field appearance="outline" *ngIf="sharedProp.action.filters.date_range">
        <mat-label>Seleccione rango de fechas</mat-label>
        <mat-date-range-input [rangePicker]="picker" (click)="picker.open()">
          <input matStartDate [(ngModel)]="sharedProp.date_range.start" readonly placeholder="Fecha inicio">
          <input matEndDate [(ngModel)]="sharedProp.date_range.end" readonly placeholder="Fecha fin">
        </mat-date-range-input>
        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-date-range-picker #picker (closed)="onSearch();"></mat-date-range-picker>
      </mat-form-field>

      <mat-form-field appearance="outline" *ngIf="sharedProp.action.filters.status">
        <mat-label>Estado</mat-label>
        <mat-select [(ngModel)]="sharedProp.status" (selectionChange)="onSearch();">
          <mat-option value="true">Activo</mat-option>
          <mat-option value="false">Inactivo</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline" *ngIf="sharedProp.action.filters.urgency">
        <mat-label>Urgencia</mat-label>
        <mat-select [(ngModel)]="sharedProp.urgency" (selectionChange)="onSearch();">
          <mat-option value="true">Urgente</mat-option>
          <mat-option value="false">Normal</mat-option>
        </mat-select>
      </mat-form-field>

      <button mat-icon-button color="accent" matTooltip="Limpiar búsqueda" class="button_filters" (click)="onSearch(1, true);">
        <mat-icon>close</mat-icon>
      </button>

      <button mat-flat-button color="accent" (click)="deleteSelectedItems()" *ngIf="this.sharedProp.selected_items.length > 0"><mat-icon>delete_forever</mat-icon>&nbsp; <small>BORRAR SELECCIÓN ({{ this.sharedProp.getTotalChecked() }})</small></button>
    </div> <!-- end fxLayout wrapper -->

    <span class="mat-spacer"></span>

    <!-- ------------------------------------------------------------------------------------------------------------------------ -->
    <!-- PAGER -->
    <!-- ------------------------------------------------------------------------------------------------------------------------ -->
    <div *ngIf="sharedProp.action.filters.pager && sharedFunctions.response.pager"> <!-- start fxLayout wrapper -->
      <div class="pager">
        <div class="pager-info divider-alt">
          Total: {{ sharedFunctions.response.pager.total_items }} <br/>
          Mostrados: {{ sharedFunctions.response.pager.viewed_items }} <br/>
          <hr class="dashed" />
          <div>
            <mat-icon class="pager-arrows" (click)="prevPage(sharedFunctions.response.pager);" [class.pager-disabled]="sharedFunctions.response.pager.actual_page === 1">chevron_left</mat-icon>
            <mat-icon class="pager-disabled">remove</mat-icon>
            <mat-icon class="pager-arrows" (click)="nextPage(sharedFunctions.response.pager);" [class.pager-disabled]="sharedFunctions.response.pager.actual_page === sharedFunctions.response.pager.number_of_pages">chevron_right</mat-icon>
          </div>
        </div>

        <div class="pager-select">
          Página
          <mat-form-field class="pager-input" appearance="standard">
            <mat-select class="pager-input-select" [(ngModel)]="sharedFunctions.response.pager.actual_page" (selectionChange)="onSearch(sharedFunctions.response.pager.actual_page);">
              <mat-option *ngFor="let currentPage of counterPages(sharedFunctions.response.pager.number_of_pages);" [value]="currentPage">{{ currentPage }}</mat-option>
            </mat-select>
          </mat-form-field>
          de {{ sharedFunctions.response.pager.number_of_pages }}
          <br/>
          Items por página:
          <mat-form-field class="pager-input" appearance="standard" style="margin-top: -17px;">
            <mat-select class="pager-input-select" [(ngModel)]="sharedFunctions.response.pager.items_per_page" (selectionChange)="setPageLimit(sharedFunctions.response.pager.items_per_page);">
              <mat-option *ngFor="let currentSize of page_sizes" [value]="currentSize">{{ currentSize }}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div class="clear"></div>
      </div>
    </div>
    <!-- ------------------------------------------------------------------------------------------------------------------------ -->

  </div>
</div>
